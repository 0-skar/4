<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>My Personal Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">
    <style>
        :root {
            --body-bg: #f0f2f5;
            --chat-area-bg: #e9ecef;
            --user-bubble-bg: #007bff;
            --assistant-bubble-bg: #ffffff;
            --controls-bg: #ffffff;
            --border-color: #ced0d4;
        }
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--body-bg);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            color: #333;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 90%;
        }
        .modal-content input[type="password"] {
            display: block;
            width: 90%;
            margin: 1.5rem auto;
            padding: 12px;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 8px;
        }
        .modal-button {
            padding: 10px 20px;
            font-size: 0.9rem;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
        }
        #api-key-modal-content p, #archive-modal-content p { font-size: 0.9rem; line-height: 1.5; color: #65676b; text-align: left; }
        #api-key-modal-content a { color: #007bff; text-decoration: none; font-weight: bold; }
        #api-key-modal-content a:hover { text-decoration: underline; }
        #api-key-modal-content .button-container, #archive-modal-content .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
            margin-top: 1.5rem;
        }
        #password-modal-content .button-container { display: flex; flex-direction: column; align-items: center; gap: 0.8rem; margin-top: 1.5rem; width: 75%; margin-left: auto; margin-right: auto; }
        #password-button { background-color: #007bff; padding: 8px 16px; }
        #return-button { background-color: #6c757d; text-decoration: none; display: block; padding: 8px 16px; }
        #save-private-key-button { background-color: #007bff; }
        #donate-key-button { background-color: #28a745; }
        #close-api-key-modal, #close-archive-modal { background-color: #6c757d; }
        
        /* ZMIANA: Style dla archiwum i przycisku usuwania */
        #archive-list { list-style-type: none; padding: 0; max-height: 300px; overflow-y: auto; text-align: left; }
        #archive-list li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        #archive-list li:hover { background-color: #f0f2f5; }
        .delete-archive-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 5px; opacity: 0.5; }
        .delete-archive-btn:hover { opacity: 1; color: #dc3545; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); } 20%, 40%, 60%, 80% { transform: translateX(10px); } }
        .is-invalid { animation: shake 0.5s; }
        #app-container { width: 100%; height: 100%; max-width: 800px; margin: 0 auto; display: none; flex-direction: column; background-color: white; }
        #app-top-bar { display: flex; align-items: center; padding: 8px; background-color: var(--controls-bg); border-bottom: 1px solid var(--border-color); flex-shrink: 0; position: relative; }
        #back-button { display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; text-decoration: none; z-index: 1; }
        #back-button:hover { background-color: rgba(0,0,0,0.05); }
        #back-button svg { width: 24px; height: 24px; fill: #333; }
        #app-title { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); margin: 0; font-size: 1.1rem; color: #333; font-weight: 600; }
        #top-right-buttons { margin-left: auto; display: flex; align-items: center; gap: 4px; padding-right: 8px; }
        .top-bar-button { background: transparent; border: none; cursor: pointer; padding: 5px; display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; font-size: 1.1rem; }
        .top-bar-button:hover { background-color: rgba(0,0,0,0.05); }
        #tts-toggle-button svg { width: 24px; height: 24px; fill: #65676b; }
        #tts-toggle-button.is-muted svg { fill: #bec3c9; }

        #avatar-container { width: 100%; padding: 8px 0; background-color: var(--controls-bg); text-align: center; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        #avatar { width: 90%; max-width: 250px; height: auto; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #message-list { flex-grow: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; background-color: var(--chat-area-bg); }
        .message-bubble { padding: 10px 14px; border-radius: 18px; max-width: 80%; line-height: 1.4; word-wrap: break-word; align-self: flex-start; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .user-message { background-color: var(--user-bubble-bg); color: white; align-self: flex-end; }
        .assistant-message { background-color: var(--assistant-bubble-bg); color: #050505; }
        .assistant-message img { max-width: 100%; border-radius: 10px; margin-top: 8px; display: block; }
        #controls-container { padding: 8px; border-top: 1px solid var(--border-color); background: var(--controls-bg); flex-shrink: 0; }
        #chat-form { display: flex; align-items: center; }
        #userInput { flex-grow: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 18px; font-size: 1rem; background: #f0f2f5; }
        #micButton { background-color: #007bff; width: 44px; height: 44px; font-size: 1.5rem; border-radius: 50%; margin-left: 8px; border: none; cursor: pointer; color: white; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        #micButton.is-listening { background-color: #fa383e; }
        #archive-button { background-color: #6c757d; width: 44px; height: 44px; font-size: 1.5rem; border-radius: 50%; margin-left: 8px; border: none; cursor: pointer; color: white; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
    </style>
</head>
<body>
    <div id="password-modal" class="modal-overlay">
        <div id="password-modal-content" class="modal-content">
            <h3>Wpisz kod dostƒôpu</h3>
            <input type="password" id="password-input">
            <div class="button-container">
                <button id="password-button" class="modal-button">Wejd≈∫</button>
                <a href="https://0-skar.github.io/0/" id="return-button" class="modal-button">Wr√≥ƒá</a>
            </div>
        </div>
    </div>

    <div id="api-key-modal" class="modal-overlay">
        <div id="api-key-modal-content" class="modal-content">
            <h3 id="api-key-modal-title">Podaj w≈Çasny klucz API</h3>
            <p id="api-key-modal-desc">Je≈õli wsp√≥lne klucze API siƒô wyczerpiƒÖ, mo≈ºesz kontynuowaƒá rozmowƒô u≈ºywajƒÖc swojego darmowego klucza Gemini.</p>
            <p>Mo≈ºesz go uzyskaƒá na stronie <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.</p>
            <p>Mo≈ºesz te≈º wesprzeƒá projekt, dodajƒÖc sw√≥j klucz do wsp√≥lnej, rotacyjnej puli dla wszystkich u≈ºytkownik√≥w.</p>
            <input type="password" id="user-api-key-input" placeholder="Wklej sw√≥j klucz API tutaj">
            <div class="button-container">
                <button id="save-private-key-button" class="modal-button">U≈ºyj tylko dla mnie</button>
                <button id="donate-key-button" class="modal-button">Dodaj do wsp√≥lnej puli</button>
                <button id="close-api-key-modal" class="modal-button">Anuluj</button>
            </div>
        </div>
    </div>

    <div id="archive-modal" class="modal-overlay">
        <div id="archive-modal-content" class="modal-content">
            <h3>Archiwum Rozm√≥w</h3>
            <p>Tutaj znajdziesz swoje lokalnie zarchiwizowane rozmowy. Kliknij, aby wczytaƒá, lub u≈ºyj kosza, aby usunƒÖƒá.</p>
            <ul id="archive-list"></ul>
            <div class="button-container">
                <button id="close-archive-modal" class="modal-button">Zamknij</button>
            </div>
        </div>
    </div>

    <div id="app-container">
        <div id="app-top-bar">
            <a href="https://0-skar.github.io/0/" id="back-button">
                <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </a>
            <h2 id="app-title">Cyfrowy Kumpel</h2>
            <div id="top-right-buttons">
                <button id="archive-list-button" class="top-bar-button">üóÑÔ∏è</button>
                <button id="api-key-button" class="top-bar-button">üîë</button>
                <button id="tts-toggle-button" class="top-bar-button"></button>
            </div>
        </div>
        <div id="avatar-container">
            <img id="avatar" src="https://raw.githubusercontent.com/0-skar/4/main/avatar-still.png" alt="Assistant Avatar">
        </div>
        <div id="message-list"></div>
        <div id="controls-container">
            <form id="chat-form">
                <input type="text" id="userInput" placeholder="Dajesz, powiedz co tam w necie piszczy..." autocomplete="off">
                <button type="button" id="micButton">üé§</button>
                <button type="button" id="archive-button">üíæ</button>
            </form>
        </div>
    </div>

    <script>
        const ACCESS_CODE = "2017";
        const BASE_BACKEND_URL = "https://twoj-space-name.hf.space"; 
        const CHAT_URL = `${BASE_BACKEND_URL}/chat`;
        const DONATE_URL = `${BASE_BACKEND_URL}/donate-key`;
        const IMAGE_BACKEND_URL = "https://image.pollinations.ai/prompt/";
        
        const AVATAR_STILL_URL = "https://raw.githubusercontent.com/0-skar/4/main/avatar-still.png";
        const AVATAR_TALKING_URL = "https://raw.githubusercontent.com/0-skar/4/main/avatar-talking.gif";

        const GREETINGS = [ "Siema. Co tam dzi≈õ scrollujesz zamiast robiƒá co≈õ po≈ºytecznego? üòâ", "Elo. Zasilanie w≈ÇƒÖczone. Got√≥w na marnowanie czasu w necie?", "Cze≈õƒá. W co dzisiaj grasz? A mo≈ºe chcesz, ≈ºebym co≈õ namalowa≈Ç? üòé" ];

        // ... (pobieranie element√≥w DOM, w tym nowych dla archiwum)
        const appContainer = document.getElementById('app-container');
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');
        const passwordButton = document.getElementById('password-button');
        const userInput = document.getElementById('userInput');
        const messageList = document.getElementById('message-list');
        const micButton = document.getElementById('micButton');
        const avatar = document.getElementById('avatar');
        const ttsToggleButton = document.getElementById('tts-toggle-button');
        const chatForm = document.getElementById('chat-form');
        const apiKeyModal = document.getElementById('api-key-modal');
        const userApiKeyInput = document.getElementById('user-api-key-input');
        const savePrivateKeyButton = document.getElementById('save-private-key-button');
        const donateKeyButton = document.getElementById('donate-key-button');
        const closeApiKeyModal = document.getElementById('close-api-key-modal');
        const apiKeyButton = document.getElementById('api-key-button');
        const archiveButton = document.getElementById('archive-button');
        const archiveListButton = document.getElementById('archive-list-button');
        const archiveModal = document.getElementById('archive-modal');
        const archiveList = document.getElementById('archive-list');
        const closeArchiveModal = document.getElementById('close-archive-modal');
        
        const synth = window.speechSynthesis;
        let voices = [];
        let isTtsEnabled = true;
        let conversationHistory = [];
        let lastUserMessage = "";

        // ... (funkcje displayInitialGreeting, checkAuthentication, etc. bez zmian) ...
        function displayInitialGreeting() { if (conversationHistory.length === 0) { const randomGreeting = GREETINGS[Math.floor(Math.random() * GREETINGS.length)]; addMessageToChat(randomGreeting, false); speak(randomGreeting); } }
        function checkAuthentication() { if (sessionStorage.getItem('isAuthenticated') === 'true') { passwordModal.style.display = 'none'; appContainer.style.display = 'flex'; initSpeechSynthesis(); displayInitialGreeting(); } else { passwordModal.style.display = 'flex'; appContainer.style.display = 'none'; } }
        function initSpeechSynthesis() { populateVoiceList(); if (synth.onvoiceschanged !== undefined) { synth.onvoiceschanged = populateVoiceList; } }
        function handlePasswordAttempt() { if (passwordInput.value === ACCESS_CODE) { sessionStorage.setItem('isAuthenticated', 'true'); checkAuthentication(); } else { passwordInput.parentElement.classList.add('is-invalid'); setTimeout(() => { passwordInput.parentElement.classList.remove('is-invalid'); }, 500); } }
        passwordButton.addEventListener('click', handlePasswordAttempt);
        passwordInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') handlePasswordAttempt(); });
        const speakerOnIcon = `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>`;
        const speakerOffIcon = `<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L7 9.02 12 14v-2.18l-2.01-2.01L12 7.82V4z"/></svg>`;
        function updateTtsToggleIcon() { ttsToggleButton.innerHTML = isTtsEnabled ? speakerOnIcon : speakerOffIcon; ttsToggleButton.classList.toggle('is-muted', !isTtsEnabled); }
        ttsToggleButton.addEventListener('click', () => { isTtsEnabled = !isTtsEnabled; updateTtsToggleIcon(); if (!isTtsEnabled) synth.cancel(); });
        function populateVoiceList() { voices = synth.getVoices(); }
        function stripEmojis(text) { const emojiRegex = /\p{Emoji_Presentation}/gu; return text.replace(emojiRegex, ''); }
        function speak(text) { /* ... kod speak bez zmian ... */ }
        async function generateImage(prompt) { /* ... kod generateImage bez zmian ... */ }

        function showApiKeyModal() { apiKeyModal.style.display = 'flex'; }
        function hideApiKeyModal() { apiKeyModal.style.display = 'none'; }
        apiKeyButton.addEventListener('click', showApiKeyModal);
        savePrivateKeyButton.addEventListener('click', () => { const userKey = userApiKeyInput.value.trim(); if (userKey) { sessionStorage.setItem('userProvidedApiKey', userKey); hideApiKeyModal(); addMessageToChat("Dziƒôki! Spr√≥bujmy jeszcze raz z Twoim prywatnym kluczem... üëç", false, false); handleSubmit(true); } });
        donateKeyButton.addEventListener('click', async () => { const userKey = userApiKeyInput.value.trim(); if (!userKey) return; addMessageToChat("Wysy≈Çam Tw√≥j klucz do weryfikacji... Dziƒôkujƒô za wsparcie! ‚ù§Ô∏è", false, false); hideApiKeyModal(); try { const response = await fetch(DONATE_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ apiKey: userKey }) }); if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.detail); } sessionStorage.setItem('userProvidedApiKey', userKey); addMessageToChat("Donacja przyjƒôta! U≈ºywam Twojego klucza do odpowiedzi.", false, false); handleSubmit(true); } catch (error) { addMessageToChat(`B≈ÇƒÖd podczas donacji: ${error.message}`, false, false); } });
        closeApiKeyModal.addEventListener('click', hideApiKeyModal);

        function archiveConversation() {
            if (conversationHistory.length < 2) { addMessageToChat("Nie ma czego archiwizowaƒá!", false, false); return; }
            const timestamp = new Date().toISOString();
            const key = `archivedConversation_${timestamp}`;
            try {
                localStorage.setItem(key, JSON.stringify(conversationHistory));
                addMessageToChat("Rozmowa zarchiwizowana lokalnie! üíæ", false, false);
            } catch (e) { addMessageToChat("B≈ÇƒÖd archiwizacji. Ma≈Ço miejsca w pamiƒôci przeglƒÖdarki.", false, false); console.error("B≈ÇƒÖd zapisu do localStorage:", e); }
        }

        // ZMIANA: Ulepszona funkcja z dodaniem przycisku usuwania
        function loadArchivedConversations() {
            archiveList.innerHTML = '';
            const keys = Object.keys(localStorage).filter(k => k.startsWith('archivedConversation_'));
            if (keys.length === 0) {
                archiveList.innerHTML = '<li>Brak zarchiwizowanych rozm√≥w.</li>';
                return;
            }
            keys.sort().reverse().forEach(key => {
                const item = document.createElement('li');
                const date = new Date(key.split('_')[1]);
                
                const dateSpan = document.createElement('span');
                dateSpan.textContent = `Rozmowa z: ${date.toLocaleString('pl-PL')}`;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-archive-btn';
                deleteBtn.innerHTML = 'üóëÔ∏è';
                deleteBtn.dataset.key = key;

                deleteBtn.addEventListener('click', (event) => {
                    event.stopPropagation(); // Zapobiegaj wczytaniu rozmowy po klikniƒôciu kosza
                    const keyToDelete = event.currentTarget.dataset.key;
                    if (confirm('Czy na pewno chcesz trwale usunƒÖƒá tƒô rozmowƒô?')) {
                        localStorage.removeItem(keyToDelete);
                        loadArchivedConversations(); // Od≈õwie≈º listƒô
                    }
                });

                item.appendChild(dateSpan);
                item.appendChild(deleteBtn);
                item.dataset.key = key;

                item.addEventListener('click', (event) => {
                    if (event.target === deleteBtn) return; // Nie wczytuj, je≈õli klikniƒôto w kosz
                    const storedHistory = localStorage.getItem(key);
                    if (storedHistory) {
                        conversationHistory = JSON.parse(storedHistory);
                        messageList.innerHTML = '';
                        conversationHistory.forEach(msg => addMessageToChat(msg.content, msg.role === 'user', false, msg.imageUrl, msg.isHidden));
                        hideArchiveModal();
                    }
                });
                archiveList.appendChild(item);
            });
        }
        
        function showArchiveModal() { loadArchivedConversations(); archiveModal.style.display = 'flex'; }
        function hideArchiveModal() { archiveModal.style.display = 'none'; }
        archiveButton.addEventListener('click', archiveConversation);
        archiveListButton.addEventListener('click', showArchiveModal);
        closeArchiveModal.addEventListener('click', hideArchiveModal);
        
        async function handleSubmit(isRetry = false) {
            if (!sessionStorage.getItem('isAuthenticated')) return;
            let userText;
            if (isRetry) {
                userText = lastUserMessage;
            } else {
                userText = userInput.value.trim();
                if (!userText) return;
                lastUserMessage = userText;
                addMessageToChat(userText, true);
                userInput.value = '';
            }
            const historySlice = conversationHistory.slice(-10);
            const requestBody = { history: historySlice };
            const userKey = sessionStorage.getItem('userProvidedApiKey');
            if (userKey) requestBody.apiKey = userKey;

            try {
                const response = await fetch(CHAT_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestBody) });
                if (!response.ok) {
                    const errorData = await response.json();
                    if (errorData.all_keys_exhausted) {
                        document.getElementById('api-key-modal-title').innerText = "Wsp√≥lne klucze wyczerpane";
                        document.getElementById('api-key-modal-desc').innerText = "Wszystkie publiczne klucze API osiƒÖgnƒô≈Çy sw√≥j dzienny limit. Aby kontynuowaƒá, podaj w≈Çasny klucz.";
                        showApiKeyModal();
                    } else { throw new Error(errorData.detail || 'Nieznany b≈ÇƒÖd serwera'); }
                    return;
                }
                const data = await response.json();
                const assistantText = data.generated_text;
                const imgMatch = assistantText.match(/\[IMG\](.*?)\[\/IMG\]/);
                if (imgMatch && imgMatch[1]) {
                    addMessageToChat(assistantText, false, true, null, true);
                    generateImage(imgMatch[1]);
                } else {
                    addMessageToChat(assistantText, false);
                    speak(assistantText);
                }
            } catch (error) {
                addMessageToChat(`B≈ÇƒÖd: ${error.message}`, false, false);
                console.error("B≈ÇƒÖd handleSubmit:", error);
            }
        }
        
        function addMessageToChat(text, isUser, addToHistory = true, imageUrl = null, isHidden = false) {
            if (addToHistory) {
                const historyEntry = { role: isUser ? 'user' : 'assistant', content: text };
                if (imageUrl) historyEntry.imageUrl = imageUrl;
                if (isHidden) historyEntry.isHidden = true;
                conversationHistory.push(historyEntry);
            }
            if (isHidden) return;
            const messageBubble = document.createElement('div');
            messageBubble.className = `message-bubble ${isUser ? 'user' : 'assistant'}-message`;
            const cleanText = text.replace(/\[\/?(PL|EN|DE|FR|ES|IMG)\]/gi, '');
            if (imageUrl) {
                const image = document.createElement('img');
                image.src = imageUrl;
                image.alt = cleanText;
                messageBubble.appendChild(image);
            } else {
                if (cleanText) messageBubble.innerText = cleanText;
            }
            if (cleanText || imageUrl) {
                messageList.appendChild(messageBubble);
                messageList.scrollTop = messageList.scrollHeight;
            }
        }

        chatForm.addEventListener('submit', (e) => { e.preventDefault(); handleSubmit(false); });
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            let isListening = false;
            micButton.addEventListener('click', () => { if (!sessionStorage.getItem('isAuthenticated')) return; if (isListening) { recognition.stop(); } else { userInput.value = ''; recognition.lang = 'pl-PL'; recognition.start(); } });
            recognition.onstart = () => { isListening = true; micButton.classList.add('is-listening'); };
            recognition.onend = () => { isListening = false; micButton.classList.remove('is-listening'); if (userInput.value.trim()){ handleSubmit(false); } };
            recognition.onresult = (event) => { let interim_transcript = ''; let final_transcript = ''; for (let i = event.resultIndex; i < event.results.length; ++i) { const transcript = event.results[i][0].transcript; if (event.results[i].isFinal) { final_transcript += transcript; } else { interim_transcript += transcript; } } userInput.value = final_transcript + interim_transcript; };
            recognition.onerror = (event) => { console.error("B≈ÇƒÖd rozpoznawania mowy:", event.error); isListening = false; micButton.classList.remove('is-listening'); };
        } else {
            micButton.style.display = 'none';
        }
        
        updateTtsToggleIcon();
        checkAuthentication();
    </script>
</body>
</html>
